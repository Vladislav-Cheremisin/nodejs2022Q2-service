## Установка приложения:

1. Установите LTS версию NodeJS с официального сайта.
2. Скачайте файлы приложения нажав на кнопку `Code` в правом верхнем углу репозитория и выбрав из контекстного меню удобный для вас способ загрузки.
3. Распакуйте файлы приложения на локальном диске своего устройства.
4. Откройте папку с файлами приложения используя редактор кода (например VSCode) или консоль.
5. Выполните команду `npm install`

## Запуск приложения с использованием Docker контейнера:

1. Скачайте и установите Docker с официального сайта.
2. Произведите регитсрацию и авторизацию в Docker для того чтобы все изложенные ниже скрипты работали корректно.
3. Выполните в консоли следующую команду для создания контейнера:

- `npm run docker:buld`

4. Дождитесь пока построится образ проекта и выполнятся миграции в базу данных postgres.
5. Приложение запущено.

6. Используйте следующие команды для запуска и остановки приложения:

- `npm run docker:start`
- `npm run docker:stop`

Для того чтобы **просканировать** приложение на наличие уязвимостей используйте следующие команды:

Для сканирования образа с приложением:

- `npm run docker:scan-app`

Для сканирования образа с базой данных:

- `npm run docker:scand-db`

## Загрузка образов приложения с Docker hub:

При необходимости вы можете загрузить необходимые для работы приложения образы с Docker Hub используя следующие консольные команды:

Для загрузки образа приложения:

`docker pull ch1rik/nodejs-service:app`

Для загрузки образа базы данных:

`docker pull ch1rik/nodejs-service:database`

## Запуск приложения без использования Docker контейнера:

1. Выполните в консоли команду `npm install` для того чтобы установить все необходимые пакеты.
2. Запустите postgres базу данных и укажите все необходимые для подключения к ней данные в .env файле.
3. Выполните в консоли одну из следующих команд позволяющих произвести запуск:

- `npm run start` - Запустить приложение.
- `npm run start:dev` - Запустить приложение в режиме разработки (с использованием Nodemon).

**Внимание для запуска приложения без docker нужно запустить отдельно базу данных (можно использовать образ в докере, ссылка выше)**

Если открыть приложение в браузере (по умолчанию http://localhost:4000), то на корневой конечной точке (`/`) можно взаимодействовать с `yaml` документацией.

## Настройка приложения:

Порт используемый по умолчанию для работы приложения содержится в файле `.env`, вы можете отредактировать его при необходимости.

## Логгирование запросов

В приложении реализован **logging service**
Логи приложения сохраняются в папку logs в корне приложения (будет автоматически создана после первого запроса)
Настройка сервиса происходит в .env файле путем изменения значений переменной окружения **LOG_LEVEL** от 0 до 5.

- 0 - не сохранять логи
- 1 - сохранять логи успешных запросов
- 2 - сохранять логи ошибок
- 3 - сохранять логи предупреждений
- 4 - сохранять debug логи с дополнительной информацией о запросе **(по умалчанию)**
- 5 - сохранять verbose логи с еще большим количеством информации о запросе

Также посредством переменной **MAX_LOGFILE_SIZE** можно указать максимальный размер для файла с логами в киллобайтах (по умолчанию 20).
После того как файл с логами достигнет указанного размера будет создан новый файл, в котором продолжиться логирование.

## Обработка ошибок

В приложении реализован кастомный **Exception filter** который обрабатывает все ошибки включая **uncaughtException** и **unhandledRejection**.

## Функционал приложения

Для начала работы с сервисом необходимо:

- Создать нового пользователя
- Авторизоваться и получить jwt access и refresh токены.
- Передавать jwt access токен в Authorization Header при запросе на любые конечные точки сервиса.

**При истечении срока действия jwt токена, обновите его используя полученный при авторизации refreshToken**

---

Доступные конечные точки для авторизации:

- **POST** `/auth/signup` - создать нового пользователя
- **POST** `/auth/login` - авторизоваться и получить access и refresh токены
- **POST** `/auth/refresh` - обновить access и refresh токены

---

Дотсупные конечные точки и запросы:

Конечная точка `/user`:

- **GET** `/user`- получить всех пользователей
- **GET** `/user/:id` - получить одного пользователя по id (uuid v4)
- **POST** `/user` - создать пользователя

Обязательные свойства в теле запроса:

`login: string`

`password: string`

- **PUT** `/user/:id` - изменить пароль пользователя
- **DELETE** `/user/:id` - удалить пользователя

---

Конечная точка `/track`:

- **GET** `/track` - получить все треки
- **GET** `/track/:id` - получить один трек по id (uuid v4)
- **POST** `/track` - создать трек

Обязательные свойства в теле запроса:

`name: string`

`duration: number`

- **PUT** `/track/:id` - обновить данные о треке
- **DELETE** `/track/:id` - удалить трек

---

Конечная точка `/artist`:

- **GET** `/artist` - получить всех артистов
- **GET** `/artist/:id` - получить данные одного пользователя по id (uuid v4)
- **POST** `/artist` - создать артиста

Обязательные свойства в теле запроса:

`name: string`

`grammy: boolean`

- **PUT** `/artist/:id` - обновить данные артиста
- **DELETE** `/artist:id` - удалить артиста

---

Конечная точка `/album`:

- **GET** `/album` - получить все альбомы
- **GET** `/album/:id` - получить данные о одном из альбомов по id (uuid v4)
- **POST** `/album/` - создать альбом

Обязательные свойства в теле запроса:

`name: string`

`year: number`

- **PUT** `/album/:id` - обновить данные альбома
- **DELETE** `/album/:id` - удалить альбом

---

Конечная точка `/favs`

- **GET** `/favs` - получить данные о избранных треках, артистах, альбомах
- **POST** `/favs/track/:id` - добавить трек в избранное
- **DELETE** `/favs/track/:id` - удалить трек из избранного
- **POST** `/favs/album/:id` - добавить альбом в избранное
- **DELETE** `/favs/album/:id` - удалить альбом из избранного
- **POST** `/favs/artist/:id` - добавить артиста в избранное
- **DELETE** `/favs/artist/:id` - удалить артиста из избранного

## Тестирование приложения:

Приложение имеет следующие консольные команды позволяющие произвести тестирование приложения:

`npm run test:auth` - Запустить все имеющиеся тесты (небходимо использовать auth тесты, так как аутентификация уже реализована)

`npm run test -- <Путь к тест кейсу>` - Запустить отдельный набор тестов

## Форматирование кода:

Приложение имеет следующие консольные команды позволяющие произвести форматирование кода приложения:

`npm run lint` - проверить код посредством линтера

`npm run format` - отформатировать код

## Контакты:

В случае необходимости получения дополнительной информации, и/или каких либо разъяснений по логике работы приложения можете связаться со мной:

- Discord: `ch1rik#2995`
- Email: `vladislav@cheremis.in`

**Приятного пользования!**
